<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/dove-favicon.svg" id="favicon-link" />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Welcome to Second Slavic Baptist Church" id="meta-description" />
  <title>ChurchLink</title>

  <!-- Open Graph Meta Tags for Social Media -->
  <meta property="og:title" content="Second Slavic Baptist Church" id="og-title" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="Welcome to Second Slavic Baptist Church" id="og-description" />
  <meta property="og:image" content="" id="og-image" />

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Second Slavic Baptist Church" id="twitter-title" />
  <meta name="twitter:description" content="Welcome to Second Slavic Baptist Church" id="twitter-description" />
  <meta name="twitter:image" content="" id="twitter-image" />

  <!-- Set absolute URL for og:image immediately -->
  <script>
    (function() {
      const baseUrl = window.location.origin;
      const defaultImage = baseUrl + '/dove-favicon.svg';
      document.getElementById('og-image').setAttribute('content', defaultImage);
      document.getElementById('twitter-image').setAttribute('content', defaultImage);
    })();
  </script>

  <!-- Apply cached website config immediately to prevent flash -->
  <script>
    (function() {
      try {
        // Check if we're visiting the same page as last time
        const currentPath = window.location.pathname;
        const lastPageSlug = localStorage.getItem('last_page_slug');
        const lastPageTitle = localStorage.getItem('last_page_title');

        // If we're on the same page and have a cached title, use it
        if (lastPageSlug && lastPageTitle && currentPath.includes(lastPageSlug)) {
          document.title = lastPageTitle;

          // Update OG and Twitter meta tags
          const ogTitle = document.getElementById('og-title');
          if (ogTitle) ogTitle.setAttribute('content', lastPageTitle);

          const twitterTitle = document.getElementById('twitter-title');
          if (twitterTitle) twitterTitle.setAttribute('content', lastPageTitle);
        } else {
          // Otherwise, use the website config title
          const cached = localStorage.getItem('website_config');
          if (cached) {
            const config = JSON.parse(cached);

            if (config.title) {
              document.title = config.title;

              // Update OG and Twitter meta tags
              const ogTitle = document.getElementById('og-title');
              if (ogTitle) ogTitle.setAttribute('content', config.title);

              const twitterTitle = document.getElementById('twitter-title');
              if (twitterTitle) twitterTitle.setAttribute('content', config.title);
            }
          }
        }

        const cached = localStorage.getItem('website_config');
        if (cached) {
          const config = JSON.parse(cached);

          // Update favicon immediately
          if (config.favicon_url) {
            const link = document.getElementById('favicon-link');
            if (link) {
              link.href = config.favicon_url;
              link.type = config.favicon_url.endsWith('.svg') ? 'image/svg+xml' : 'image/x-icon';
            }
          }

          // Update meta description
          if (config.meta_description) {
            const metaDesc = document.getElementById('meta-description');
            if (metaDesc) metaDesc.setAttribute('content', config.meta_description);

            const ogDesc = document.getElementById('og-description');
            if (ogDesc) ogDesc.setAttribute('content', config.meta_description);

            const twitterDesc = document.getElementById('twitter-description');
            if (twitterDesc) twitterDesc.setAttribute('content', config.meta_description);
          }

          // Update OG image
          if (config.og_image) {
            // Convert relative URL to absolute for social media
            const baseUrl = window.location.origin;
            const imageUrl = config.og_image.startsWith('http') ? config.og_image : baseUrl + config.og_image;

            const ogImage = document.getElementById('og-image');
            if (ogImage) ogImage.setAttribute('content', imageUrl);

            const twitterImage = document.getElementById('twitter-image');
            if (twitterImage) twitterImage.setAttribute('content', imageUrl);
          } else {
            // Set absolute URL for default favicon
            const baseUrl = window.location.origin;
            const defaultImage = baseUrl + '/dove-favicon.svg';

            const ogImage = document.getElementById('og-image');
            if (ogImage) ogImage.setAttribute('content', defaultImage);

            const twitterImage = document.getElementById('twitter-image');
            if (twitterImage) twitterImage.setAttribute('content', defaultImage);
          }
        }
      } catch (e) {
        // Silently fail - defaults will be used
      }
    })();
  </script>
</head>

<body>
  <div id="root"></div>
  <div id="web-editor-preview"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>